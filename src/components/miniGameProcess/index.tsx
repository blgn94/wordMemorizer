/**
*   MiniGameSection Ð±Ò¯Ñ€ÑÐ»Ð´ÑÑ…Ò¯Ò¯Ð½ Ñ…ÑÑÑÐ³ 
*   
*   Ð­Ð½Ñ Ð±Ò¯Ñ€ÑÐ»Ð´ÑÑ…Ò¯Ò¯Ð½ Ñ…ÑÑÑÐ³ Ð½ÑŒ Ñ…ÑÑ€ÑÐ³Ð»ÑÐ³Ñ‡Ð¸Ð´ Ð°Ð½Ð³Ð»Ð¸ Ò¯Ð³ Ð±Ð¾Ð»Ð¾Ð½ Ñ…Ð°Ñ€Ð³Ð°Ð»Ð·Ð°Ñ… Ñ‚Ð°Ð¹Ð»Ð±Ð°Ñ€Ñ‹Ð³ Ñ‚Ð¾Ñ…Ð¸Ñ€ÑƒÑƒÐ»Ð°Ð½ Ñ‚Ð¾Ð³Ð»Ð¾Ñ… Ñ‚Ð¾Ð³Ð»Ð¾Ð¾Ð¼ ÑŽÐ¼.  
*   Ð¥ÑÑ€ÑÐ³Ð»ÑÐ³Ñ‡Ð¸Ð´ Ñ‚Ð¾Ñ…Ð¸Ñ€Ð¾Ñ… Ñ…Ð¾ÑÑ‹Ð³ Ð¾Ð»Ð¾Ñ…Ñ‹Ð½ Ñ‚ÑƒÐ»Ð´ ÐºÐ°Ñ€Ñ‚ÑƒÑƒÐ´Ñ‹Ð³ ÑÑ€Ð³Ò¯Ò¯Ð»ÑÑ… Ñ…ÑÑ€ÑÐ³Ñ‚ÑÐ¹. Ð¢Ð¾Ð³Ð»Ð¾Ð¾Ð¼ Ð½ÑŒ Ð½Ò¯Ò¯Ð´Ð»Ð¸Ð¹Ð½ Ñ‚Ð¾Ð¾Ð³ Ñ…ÑÐ½Ð°Ð´Ð°Ð³ 
*   Ð±Ó©Ð³Ó©Ó©Ð´ Ð±Ò¯Ñ… Ñ…Ð¾ÑÑƒÑƒÐ´ Ñ‚Ð°Ð°Ñ€Ð²Ð°Ð» ÑÐ»Ð°Ð»Ñ‚Ñ‹Ð½ Ñ…ÑƒÑƒÐ´ÑÑ‹Ð³ Ð¸Ð´ÑÐ²Ñ…Ð¶Ò¯Ò¯Ð»Ð´ÑÐ³.
*
*   Properties:
*   - vocabulary: ÐÐ½Ð³Ð»Ð¸, Ð¼Ð¾Ð½Ð³Ð¾Ð» Ñ…ÑÐ»Ð½Ð¸Ð¹ Ñ…Ð¾Ñ Ò¯Ð³ Ð°Ð³ÑƒÑƒÐ»ÑÐ°Ð½ Ð¾Ð±ÑŠÐµÐºÑ‚ÑƒÑƒÐ´Ñ‹Ð½ Ð¼Ð°ÑÑÐ¸Ð².
*   - setWhichMenuClicked: Ò®Ð½Ð´ÑÑÐ½ Ð±Ò¯Ñ€ÑÐ»Ð´ÑÑ…Ò¯Ò¯Ð½ Ñ…ÑÑÐ³Ð¸Ð¹Ð½ Ð¸Ð´ÑÐ²Ñ…Ñ‚ÑÐ¹ Ñ†ÑÑÐ¸Ð¹Ð³ Ñ‚Ð¾Ñ…Ð¸Ñ€ÑƒÑƒÐ»Ð°Ñ… Ñ„ÑƒÐ½ÐºÑ†.
*   - moves: Ð¥ÑÑ€ÑÐ³Ð»ÑÐ³Ñ‡Ð¸Ð¹Ð½ Ñ…Ð¸Ð¹ÑÑÐ½ Ð½Ò¯Ò¯Ð´Ð»Ð¸Ð¹Ð½ Ñ‚Ð¾Ð¾.
*   - setMoves: Ð¥Ó©Ð´Ó©Ð»Ð³Ó©Ó©Ð½Ð¸Ð¹ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð³ ÑˆÐ¸Ð½ÑÑ‡Ð»ÑÑ… Ñ„ÑƒÐ½ÐºÑ†.
*   
*   Ð¤ÑƒÐ½ÐºÑ†ÑƒÑƒÐ´:
*   - initialize(): Ð¢Ð¾Ð³Ð»Ð¾Ð¾Ð¼Ñ‹Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð³ Ð´Ð°Ñ…Ð¸Ð½ Ñ‚Ð¾Ñ…Ð¸Ñ€ÑƒÑƒÐ»Ð¶, ÐºÐ°Ñ€Ñ‚ÑƒÑƒÐ´Ñ‹Ð³ Ñ…Ð¾Ð»ÑŒÐ¶, Ñ…Ó©Ð´Ó©Ð»Ð³Ó©Ó©Ð½Ð¸Ð¹Ð³ Ñ‚ÑÐ³ Ð±Ð¾Ð»Ð³Ð¾Ð¶ Ñ‚Ð¾Ñ…Ð¸Ñ€ÑƒÑƒÐ»Ð½Ð°.
*   - shuffle(): Ð¡Ð°Ð½Ð°Ð¼ÑÐ°Ñ€Ð³Ò¯Ð¹ ÑÐ°Ð¼Ð±Ð°Ñ€ Ò¯Ò¯ÑÐ³ÑÑ…Ð¸Ð¹Ð½ Ñ‚ÑƒÐ»Ð´ ÐºÐ°Ñ€Ñ‚ÑƒÑƒÐ´Ñ‹Ð³ Ñ…Ð¾Ð»Ð¸Ð½Ð¾.
*   - updateActiveCards(i): Ð¥ÑÑ€ÑÐ³Ð»ÑÐ³Ñ‡Ð¸Ð¹Ð½ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð½ Ò¯Ð¹Ð»Ñ‡Ð»ÑÐ»Ð´ Ò¯Ð½Ð´ÑÑÐ»ÑÐ½ ÐºÐ°Ñ€Ñ‚ÑƒÑƒÐ´Ñ‹Ð³ ÑÑ€Ð³Ò¯Ò¯Ð»ÑÑ…, Ñ‚Ð°Ð°Ñ€ÑƒÑƒÐ»Ð°Ñ… Ð»Ð¾Ð³Ð¸ÐºÐ¸Ð¹Ð³ Ð·Ð¾Ñ…Ð¸Ñ†ÑƒÑƒÐ»Ð´Ð°Ð³.
*   - useEffect(): Ð¥Ó©Ð´Ó©Ð»Ð³Ó©Ó©Ð½Ð¸Ð¹ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð³ Ñ…ÑÐ½Ð°Ð´Ð°Ð³ Ð±Ð° Ð±Ò¯Ñ… Ñ…Ð¾ÑÑƒÑƒÐ´ Ñ‚Ð°Ð°Ñ€Ð²Ð°Ð» ÑÐ»Ð°Ð»Ñ‚Ñ‹Ð½ Ñ…ÑƒÑƒÐ´ÑÑ‹Ð³ Ð¸Ð´ÑÐ²Ñ…Ð¶Ò¯Ò¯Ð»Ð½Ñ.
*/

import css from './style.module.css';
import { useEffect, useState } from 'react';

const MiniGameSection = ( {vocabulary, setWhichMenuClicked, moves, setMoves} : any ) => {
  const boardEnglish = [   
      vocabulary[0].wordEn + '-> ðŸ¤–',
      vocabulary[1].wordEn + '-> ðŸ‘½',
      vocabulary[2].wordEn + '-> ðŸ‘»',
      vocabulary[3].wordEn + '-> ðŸ¤¡',
      vocabulary[4].wordEn + '-> ðŸ§',
      vocabulary[5].wordEn + '-> ðŸ¦š',
      vocabulary[6].wordEn + '-> ðŸ˜„',
      vocabulary[7].wordEn + '-> ðŸš€',
  ]
  const boardMongolian = [
      vocabulary[0].definitionMn + '-> ðŸ¤–',
      vocabulary[1].definitionMn + '-> ðŸ‘½',
      vocabulary[2].definitionMn + '-> ðŸ‘»',
      vocabulary[3].definitionMn + '-> ðŸ¤¡',
      vocabulary[4].definitionMn + '-> ðŸ§',
      vocabulary[5].definitionMn + '-> ðŸ¦š',
      vocabulary[6].definitionMn + '-> ðŸ˜„',
      vocabulary[7].definitionMn + '-> ðŸš€',
  ]
  const [boardData, setBoardData] : any = useState([]);
  const [flippedCards, setFlippedCards] : any = useState([]);
  const [matchedCards, setMatchedCards] : any = useState([]);
  const [gameOver, setGameOver] = useState(false);

  useEffect(() => {
    initialize();
  }, []);

  const initialize = () => {
    shuffle();
    setGameOver(false);
    setFlippedCards([]);
    setMatchedCards([]);
    setMoves(0);
  };

  useEffect(() => {
    if (matchedCards.length == 16) {
      setGameOver(true);
      setWhichMenuClicked('miniGameWinningPage')
    }
  }, [moves]);

  const shuffle = () => {
    const shuffledCards : any = [...boardEnglish, ...boardMongolian].sort(() => Math.random() - 0.5).map((v) => v);
    setBoardData(shuffledCards);
  };

  const updateActiveCards = (i : any) => {
    if(!flippedCards.includes(i)) {
      if(flippedCards.length == 1) {
        const firstIdx = flippedCards[0];
        const secondIdx = i;
        if(boardData[firstIdx].split('->')[1] == boardData[secondIdx].split('->')[1]) {
          setMatchedCards((prev : any) => [...prev, firstIdx, secondIdx]);
        }
        setFlippedCards([...flippedCards, i]);
      }
      else if(flippedCards.length == 2) {
        setFlippedCards([i]);
      }
      else {
        setFlippedCards([...flippedCards, i]);
      }
      setMoves((v : any) => v + 1);
    }
  };

  return (
    <div className={css.container}>
        <div className={css.movesTitle}>
            <p>{`Moves: ${moves}`}</p>
        </div>
        <div className={css.board}>
            {boardData.map((data : any, i : any) => {
                const flipped = flippedCards.includes(i) ? true : false;
                const matched = matchedCards.includes(i) ? true : false;
                return (
                <div
                    onClick={() => {updateActiveCards(i);}}
                    key={i}
                    className={`${css.card} ${flipped || matched ? `${css.active}` : ""} ${matched ? `${css.matched}` : ""} ${gameOver ? `${css.gameover}` : ""}`}
                >
                    <div className={css.card_front}>{data}</div>
                    <div className={css.card_back}></div>
                </div>
                );
            })}
        </div>
        <div>
            <button onClick={() => initialize()} className={css.reset_btn}>
                Reset
            </button>
        </div>
    </div>
  );
}

export default MiniGameSection